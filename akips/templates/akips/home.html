{% extends 'akips/base.html' %}
{% load static %}

{% block title %}OCNES Dashboard{% endblock %}
{% block extra_head%}
<!-- <meta http-equiv="refresh" content="30"> -->
{% endblock %}

{% block content %}
<div id="crit_card" class="card card-primary">
    <div class="card-body table-responsive p-0" data-card-widget="card-refresh" data-source="{% url 'crit_card' %}">
    </div>
</div>

<div id="tier_card" class="card card-primary">
    <div class="card-body table-responsive p-0" data-card-widget="card-refresh" data-source="{% url 'tier_card' %}">
    </div>
</div>

<div id="bldg_card" class="card card-primary">
    <div class="card-body table-responsive p-0" data-card-widget="card-refresh" data-source="{% url 'bldg_card' %}">
    </div>
</div>

<div class="card">
    <div class="card-body table-responsive p-0">
        <table class="table table-hover table-sm">
            <thead>
                <tr>
                    <th>Ack</th>
                    <th>Device</th>
                    <th>Trap</th>
                    <th>Recorded</th>
                    <th>Incident Request</th>
                    <th>Clear Trap</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="ack_bldg_{{ bldg.id }}">
                        </div>
                    </td>
                    <td>dummy row</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% for trap in traps %}
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<audio id="audiotag1" src="{% static 'akips/sound/mixkit-wrong-answer-fail-notification-946.wav' %}" preload="auto"></audio>
<a href="javascript:play_single_sound();">Test sound</a>
{% endblock %}

{% block js %}
<script type="text/javascript">
	function play_single_sound() {
		document.getElementById('audiotag1').play();
	}
</script>
<script type="text/javascript">
	function refresh_cards() {
        $('#crit_card [data-card-widget="card-refresh"]').CardRefresh('load');
        $('#tier_card [data-card-widget="card-refresh"]').CardRefresh('load');
        $('#bldg_card [data-card-widget="card-refresh"]').CardRefresh('load');

        $('.akips_trend:contains(New)').each(function( index ) {
		    document.getElementById('audiotag1').play();
            //console.log( index + ": found New in " + $( this ).text() );
        });

        console.log("Refreshed cards");
	}
</script>
<script type="text/javascript">
    $(document).ready(function() {
        var refresh_seconds = 10000;

        $('.akips_trend:contains(New)').each(function( index ) {
		    document.getElementById('audiotag1').play();
            //console.log( index + ": found New in " + $( this ).text() );
        });

        var intervalId = window.setInterval(function(){
            refresh_cards();
        }, refresh_seconds);
    })
</script>
{% endblock %}